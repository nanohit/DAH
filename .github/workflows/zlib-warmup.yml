name: Keep Z-Library Services Warm

on:
  schedule:
    - cron: '*/10 * * * *' # every 10 minutes to prevent Render sleep
  workflow_dispatch:

jobs:
  warmup:
    runs-on: ubuntu-latest
    steps:
      # Ping all services to prevent sleep
      - name: Ping legacy server
        run: curl -sf https://dah-tyxc.onrender.com/ -o /dev/null || true
      
      - name: Ping new API
        run: curl -sf https://dah-api.onrender.com/ -o /dev/null || true
      
      - name: Wake worker A
        run: curl -sf https://zlib-worker-a.onrender.com/health -o /dev/null || true
      
      - name: Wake worker B
        run: curl -sf https://zlib-worker-b.onrender.com/health -o /dev/null || true
      
      - name: Wake worker C
        run: curl -sf https://zlib-worker-c.onrender.com/health -o /dev/null || true
      
      # Force browser reset on all workers to ensure clean state
      - name: Reset worker A browser
        run: curl -sf https://zlib-worker-a.onrender.com/reset -o /dev/null || true
      
      - name: Reset worker B browser
        run: curl -sf https://zlib-worker-b.onrender.com/reset -o /dev/null || true
      
      - name: Reset worker C browser
        run: curl -sf https://zlib-worker-c.onrender.com/reset -o /dev/null || true
      
      # Warmup keeps Z-Library sessions logged in
      - name: Trigger warmup via API
        run: curl -sf https://dah-api.onrender.com/api/books/zlibrary/warmup -o /dev/null || true
      
      - name: Log completion
        run: echo "All services pinged at $(date -u)"

